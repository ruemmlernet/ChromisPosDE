<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:ext="http://www.liquibase.org/xml/ns/dbchangelog-ext"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd
        http://www.liquibase.org/xml/ns/dbchangelog-ext http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd">

  
    <property name="boolean.type" value="boolean" dbms="derby, postgresql"/>
    <property name="boolean.type" value="bit" dbms="mysql"/>
    
    <property name="blob.type" value="blob" dbms="derby"/>
    <property name="blob.type" value="bytea" dbms="postgresql"/>
    <property name="blob.type" value="mediumblob" dbms="mysql"/>

   
    <changeSet author="Chromis POS" id="Insert into tables required indexes for migration (New Database)"> 
        <sql>CREATE UNIQUE INDEX CLOSEDCASH_INX_SEQ ON CLOSEDCASH (HOST, HOSTSEQUENCE)</sql>        
        <sql>CREATE UNIQUE INDEX THIRDPARTIES_CIF_INX ON THIRDPARTIES (CIF)</sql>        
        <sql>CREATE UNIQUE INDEX THIRDPARTIES_NAME_INX ON THIRDPARTIES (NAME)</sql>        
        <sql>CREATE UNIQUE INDEX PRODUCTS_INX_0 ON PRODUCTS (REFERENCE)</sql>        
        <sql>CREATE UNIQUE INDEX PRODUCTS_INX_1 ON PRODUCTS (CODE)</sql>        
        <sql>CREATE UNIQUE INDEX PKIT_INX_PROD ON PRODUCTS_KIT (PRODUCT,PRODUCT_KIT)</sql>        
        <sql>CREATE UNIQUE INDEX RESOURCES_NAME_INX ON RESOURCES (NAME)</sql>        
        <sql>CREATE UNIQUE INDEX ROLES_NAME_INX ON ROLES (NAME)</sql>        
        <sql>CREATE UNIQUE INDEX STOCKCURRENT_INX ON STOCKCURRENT (LOCATION,PRODUCT,ATTRIBUTESETINSTANCE_ID)</sql>        
        <sql>CREATE UNIQUE INDEX TAXCAT_NAME_INX ON TAXCATEGORIES (NAME)</sql>        
        <sql>CREATE UNIQUE INDEX TAXCUSTCAT_NAME_INX ON TAXCUSTCATEGORIES (NAME) </sql>        
        <sql>CREATE UNIQUE INDEX TAXES_NAME_INX ON TAXES (NAME)</sql>        
        <sql>CREATE UNIQUE INDEX PLACES_NAME_INX ON PLACES (NAME)</sql>        
        <sql>CREATE UNIQUE INDEX PEOPLE_NAME_INX ON PEOPLE (NAME)</sql>        
        <sql>CREATE UNIQUE INDEX LOCATIONS_NAME_INX ON LOCATIONS (NAME)</sql>        
        <sql>CREATE UNIQUE INDEX FLOORS_NAME_INX ON FLOORS (NAME)</sql>        
        <sql>CREATE UNIQUE INDEX DBPERMISSIONS_CLASSNAME_INX ON DBPERMISSIONS (CLASSNAME)</sql>              
        <sql>CREATE UNIQUE INDEX CUSTOMERS_SKEY_INX ON CUSTOMERS (SEARCHKEY)</sql>        
        <sql>CREATE UNIQUE INDEX CATEGORIES_NAME_INX ON CATEGORIES (NAME)</sql>        
        <sql>CREATE INDEX ATTSETINST_SET ON ATTRIBUTESETINSTANCE (ATTRIBUTESET_ID)</sql>        
        <sql>CREATE INDEX ATTUSE_ATT ON ATTRIBUTEUSE (ATTRIBUTE_ID) </sql>        
        <sql>CREATE UNIQUE INDEX ATTUSE_LINE ON ATTRIBUTEUSE (ATTRIBUTESET_ID, LINENO)</sql>        
        <sql>CREATE INDEX ATTVAL_ATT ON ATTRIBUTEVALUE (ATTRIBUTE_ID) </sql>        
        <sql>CREATE INDEX CLOSEDCASH_INX_1 ON CLOSEDCASH (DATESTART)</sql>        
        <sql>CREATE INDEX PLACES_FK_1 ON PLACES (FLOOR)</sql>        
        <sql>CREATE INDEX RECEIPTS_FK_MONEY ON RECEIPTS (MONEY)</sql>        
        <sql>CREATE INDEX RECEIPTS_INX_1 ON RECEIPTS (DATENEW)</sql>        
        <sql>CREATE UNIQUE INDEX RESERVATIONS_INX_1 ON RESERVATIONS (DATENEW)</sql>        
        <sql>CREATE INDEX ATTINST_ATT ON ATTRIBUTEINSTANCE (ATTRIBUTE_ID)</sql>        
        <sql>CREATE INDEX ATTINST_SET ON ATTRIBUTEINSTANCE (ATTRIBUTESETINSTANCE_ID)</sql>        
        <sql>CREATE INDEX CUSTOMERS_CARD_INX ON CUSTOMERS (CARD)</sql>        
        <sql>CREATE INDEX CUSTOMERS_NAME_INX ON CUSTOMERS (NAME)</sql>        
        <sql>CREATE INDEX CUSTOMERS_TAXCAT ON CUSTOMERS (TAXCATEGORY)</sql>        
        <sql>CREATE INDEX CUSTOMERS_TAXID_INX ON CUSTOMERS (TAXID)</sql>        
        <sql>CREATE INDEX PAYMENTS_FK_RECEIPT ON PAYMENTS (RECEIPT)</sql>        
        <sql>CREATE INDEX PAYMENTS_INX_1 ON PAYMENTS (PAYMENT)</sql>        
        <sql>CREATE INDEX PEOPLE_CARD_INX ON PEOPLE (CARD)</sql>        
        <sql>CREATE INDEX PEOPLE_FK_1 ON PEOPLE (ROLE)</sql>        
        <sql>CREATE INDEX RES_CUST_FK_2 ON RESERVATION_CUSTOMERS (CUSTOMER)</sql>        
        <sql>CREATE INDEX SHIFT_BREAKS_BREAKID ON SHIFT_BREAKS (BREAKID)</sql>        
        <sql>CREATE INDEX SHIFT_BREAKS_SHIFTID ON SHIFT_BREAKS (SHIFTID)</sql>        
        <sql>CREATE INDEX TICKETS_CUSTOMERS_FK ON TICKETS (CUSTOMER)</sql>        
        <sql>CREATE INDEX TICKETS_FK_2 ON TICKETS (PERSON)</sql>        
        <sql>CREATE INDEX TICKETS_TICKETID ON TICKETS (TICKETTYPE, TICKETID)</sql>        
        <sql>CREATE INDEX LEAVES_PPLID ON LEAVES (PPLID)</sql>        
        <sql>CREATE INDEX CATEGORIES_FK_1 ON CATEGORIES (PARENTID)</sql>        
        <sql>CREATE INDEX FK_PRODUCT_PROMOTIONID ON PRODUCTS (PROMOTIONID)</sql>        
        <sql>CREATE INDEX PRODUCTS_ATTRSET_FK ON PRODUCTS (ATTRIBUTESET_ID)</sql>        
        <sql>CREATE INDEX PRODUCTS_FK_1 ON PRODUCTS (CATEGORY)</sql>        
        <sql>CREATE INDEX PRODUCTS_PACKPRODUCT_FK ON PRODUCTS (PACKPRODUCT)</sql>        
        <sql>CREATE INDEX PRODUCTS_TAXCAT_FK ON PRODUCTS (TAXCAT)</sql>        
        <sql>CREATE UNIQUE INDEX PCOM_INX_PROD ON PRODUCTS_COM (PRODUCT, PRODUCT2)</sql>        
        <sql>CREATE INDEX PRODUCTS_COM_FK_2 ON PRODUCTS_COM (PRODUCT2)</sql>        
        <sql>CREATE INDEX PRODUCTS_KIT_FK_2 ON PRODUCTS_KIT (PRODUCT_KIT)</sql>        
        <sql>CREATE INDEX STOCKCURRENT_ATTSETINST ON STOCKCURRENT (ATTRIBUTESETINSTANCE_ID)</sql>        
        <sql>CREATE INDEX STOCKCURRENT_FK_1 ON STOCKCURRENT (PRODUCT)</sql>        
        <sql>CREATE INDEX STOCKDIARY_ATTSETINST ON STOCKDIARY (ATTRIBUTESETINSTANCE_ID)</sql>        
        <sql>CREATE INDEX STOCKDIARY_FK_1 ON STOCKDIARY (PRODUCT)</sql>        
        <sql>CREATE INDEX STOCKDIARY_FK_2 ON STOCKDIARY (LOCATION)</sql>        
        <sql>CREATE INDEX STOCKDIARY_INX_1 ON STOCKDIARY (DATENEW)</sql>        
        <sql>CREATE INDEX STOCKLEVEL_LOCATION ON STOCKLEVEL (LOCATION)</sql>        
        <sql>CREATE INDEX STOCKLEVEL_PRODUCT ON STOCKLEVEL (PRODUCT)</sql>        
        <sql>CREATE INDEX TAXES_CAT_FK ON TAXES (CATEGORY)</sql>        
        <sql>CREATE INDEX TAXES_CUSTCAT_FK ON TAXES (CUSTCATEGORY)</sql>        
        <sql>CREATE INDEX TAXES_TAXES_FK ON TAXES (PARENTID)</sql>        
        <sql>CREATE INDEX TAXLINES_RECEIPT ON TAXLINES (RECEIPT)</sql>        
        <sql>CREATE INDEX TAXLINES_TAX ON TAXLINES (TAXID)</sql>        
        <sql>CREATE INDEX TICKETLINES_FK_2 ON TICKETLINES (PRODUCT)</sql>        
        <sql>CREATE INDEX TICKETLINES_FK_3 ON TICKETLINES (TAXID)</sql>                              
        <sql>CREATE INDEX PRODUCTS_NAME_INX ON PRODUCTS (NAME)</sql> 
        <sql>CREATE INDEX TICKETLINES_ATTSETINST ON TICKETLINES (ATTRIBUTESETINSTANCE_ID)</sql>                
    </changeSet> 
                             
    <changeSet author="Chromis POS" id="Create Foreign Keys in tables part of migration (New Database)"  >    
        <sql>ALTER TABLE PEOPLE ADD CONSTRAINT PEOPLE_FK_1 FOREIGN KEY (ROLE) REFERENCES ROLES(ID)</sql>        
        <sql>ALTER TABLE CUSTOMERS ADD CONSTRAINT CUSTOMERS_TAXCAT FOREIGN KEY (TAXCATEGORY) REFERENCES TAXCUSTCATEGORIES(ID)</sql>
        <sql>ALTER TABLE CATEGORIES ADD CONSTRAINT CATEGORIES_FK_1 FOREIGN KEY (PARENTID) REFERENCES CATEGORIES(ID)</sql>
        <sql>ALTER TABLE TAXES ADD CONSTRAINT TAXES_CAT_FK FOREIGN KEY (CATEGORY) REFERENCES TAXCATEGORIES(ID)</sql>
        <sql>ALTER TABLE TAXES ADD CONSTRAINT TAXES_CUSTCAT_FK FOREIGN KEY (CUSTCATEGORY) REFERENCES TAXCUSTCATEGORIES(ID)</sql>
        <sql>ALTER TABLE TAXES ADD CONSTRAINT TAXES_TAXES_FK FOREIGN KEY (PARENTID) REFERENCES TAXES(ID)</sql>
        <sql>ALTER TABLE ATTRIBUTEVALUE ADD CONSTRAINT ATTVAL_ATT FOREIGN KEY (ATTRIBUTE_ID) REFERENCES ATTRIBUTE(ID) ON DELETE CASCADE</sql>
        <sql>ALTER TABLE ATTRIBUTEUSE ADD CONSTRAINT ATTUSE_SET FOREIGN KEY (ATTRIBUTESET_ID) REFERENCES ATTRIBUTESET(ID) ON DELETE CASCADE</sql>
        <sql>ALTER TABLE ATTRIBUTEUSE ADD CONSTRAINT ATTUSE_ATT FOREIGN KEY (ATTRIBUTE_ID) REFERENCES ATTRIBUTE(ID)</sql>
        <sql>ALTER TABLE ATTRIBUTESETINSTANCE ADD CONSTRAINT ATTSETINST_SET FOREIGN KEY (ATTRIBUTESET_ID) REFERENCES ATTRIBUTESET(ID) ON DELETE CASCADE</sql>
        <sql>ALTER TABLE ATTRIBUTEINSTANCE ADD CONSTRAINT ATTINST_SET FOREIGN KEY (ATTRIBUTESETINSTANCE_ID) REFERENCES ATTRIBUTESETINSTANCE(ID) ON DELETE CASCADE</sql>
        <sql>ALTER TABLE ATTRIBUTEINSTANCE ADD CONSTRAINT ATTINST_ATT FOREIGN KEY (ATTRIBUTE_ID) REFERENCES ATTRIBUTE(ID)</sql>
        <sql>ALTER TABLE PRODUCTS ADD CONSTRAINT PRODUCTS_FK_1 FOREIGN KEY (CATEGORY) REFERENCES CATEGORIES(ID)</sql>
        <sql>ALTER TABLE PRODUCTS ADD CONSTRAINT PRODUCTS_TAXCAT_FK FOREIGN KEY (TAXCAT) REFERENCES TAXCATEGORIES(ID)</sql>
        <sql>ALTER TABLE PRODUCTS ADD CONSTRAINT PRODUCTS_ATTRSET_FK FOREIGN KEY (ATTRIBUTESET_ID) REFERENCES ATTRIBUTESET(ID)</sql>
        <sql>ALTER TABLE PRODUCTS_COM ADD CONSTRAINT PRODUCTS_COM_FK_1 FOREIGN KEY (PRODUCT) REFERENCES PRODUCTS(ID)</sql>
        <sql>ALTER TABLE PRODUCTS_COM ADD CONSTRAINT PRODUCTS_COM_FK_2 FOREIGN KEY (PRODUCT2) REFERENCES PRODUCTS(ID)</sql>
        <sql>ALTER TABLE STOCKDIARY ADD CONSTRAINT STOCKDIARY_FK_1 FOREIGN KEY (PRODUCT) REFERENCES PRODUCTS(ID)</sql>
        <sql>ALTER TABLE STOCKDIARY ADD CONSTRAINT STOCKDIARY_ATTSETINST FOREIGN KEY (ATTRIBUTESETINSTANCE_ID) REFERENCES ATTRIBUTESETINSTANCE(ID)</sql>
        <sql>ALTER TABLE STOCKDIARY ADD CONSTRAINT STOCKDIARY_FK_2 FOREIGN KEY (LOCATION) REFERENCES LOCATIONS(ID)</sql>        
        <sql>ALTER TABLE STOCKLEVEL ADD CONSTRAINT STOCKLEVEL_PRODUCT FOREIGN KEY (PRODUCT) REFERENCES PRODUCTS(ID)</sql>
        <sql>ALTER TABLE STOCKLEVEL ADD CONSTRAINT STOCKLEVEL_LOCATION FOREIGN KEY (LOCATION) REFERENCES LOCATIONS(ID)</sql>
        <sql>ALTER TABLE STOCKCURRENT ADD CONSTRAINT STOCKCURRENT_FK_1 FOREIGN KEY (PRODUCT) REFERENCES PRODUCTS(ID)</sql>
        <sql>ALTER TABLE STOCKCURRENT ADD CONSTRAINT STOCKCURRENT_ATTSETINST FOREIGN KEY (ATTRIBUTESETINSTANCE_ID) REFERENCES ATTRIBUTESETINSTANCE(ID);</sql>
        <sql>ALTER TABLE STOCKCURRENT ADD CONSTRAINT STOCKCURRENT_FK_2 FOREIGN KEY (LOCATION) REFERENCES LOCATIONS(ID);</sql>
        <sql>ALTER TABLE RECEIPTS ADD CONSTRAINT RECEIPTS_FK_MONEY FOREIGN KEY (MONEY) REFERENCES CLOSEDCASH(MONEY)</sql>
        <sql>ALTER TABLE TICKETS ADD CONSTRAINT TICKETS_FK_ID FOREIGN KEY (ID) REFERENCES RECEIPTS(ID)</sql>
        <sql>ALTER TABLE TICKETS ADD CONSTRAINT TICKETS_FK_2 FOREIGN KEY (PERSON) REFERENCES PEOPLE(ID)</sql>
        <sql>ALTER TABLE TICKETS ADD CONSTRAINT TICKETS_CUSTOMERS_FK FOREIGN KEY (CUSTOMER) REFERENCES CUSTOMERS(ID)</sql>
        <sql>ALTER TABLE TICKETLINES ADD CONSTRAINT TICKETLINES_FK_TICKET FOREIGN KEY (TICKET) REFERENCES TICKETS(ID)</sql>
        <sql>ALTER TABLE TICKETLINES ADD CONSTRAINT TICKETLINES_FK_2 FOREIGN KEY (PRODUCT) REFERENCES PRODUCTS(ID)</sql>
        <sql>ALTER TABLE TICKETLINES ADD CONSTRAINT TICKETLINES_ATTSETINST FOREIGN KEY (ATTRIBUTESETINSTANCE_ID) REFERENCES ATTRIBUTESETINSTANCE(ID)</sql>
        <sql>ALTER TABLE TICKETLINES ADD CONSTRAINT TICKETLINES_FK_3 FOREIGN KEY (TAXID) REFERENCES TAXES(ID)</sql>
        <sql>ALTER TABLE PAYMENTS ADD CONSTRAINT PAYMENTS_FK_RECEIPT FOREIGN KEY (RECEIPT) REFERENCES RECEIPTS(ID)</sql>
        <sql>ALTER TABLE TAXLINES ADD CONSTRAINT TAXLINES_TAX FOREIGN KEY (TAXID) REFERENCES TAXES(ID)</sql>
        <sql>ALTER TABLE TAXLINES ADD CONSTRAINT TAXLINES_RECEIPT FOREIGN KEY (RECEIPT) REFERENCES RECEIPTS(ID)</sql>
        <sql>ALTER TABLE PLACES ADD CONSTRAINT PLACES_FK_1 FOREIGN KEY (FLOOR) REFERENCES FLOORS(ID)</sql>
        <sql>ALTER TABLE RESERVATION_CUSTOMERS ADD CONSTRAINT RES_CUST_FK_1 FOREIGN KEY (ID) REFERENCES RESERVATIONS(ID)</sql>
        <sql>ALTER TABLE RESERVATION_CUSTOMERS ADD CONSTRAINT RES_CUST_FK_2 FOREIGN KEY (CUSTOMER) REFERENCES CUSTOMERS(ID)</sql>
        <sql>ALTER TABLE LEAVES ADD CONSTRAINT LEAVES_PPLID FOREIGN KEY (PPLID) REFERENCES PEOPLE(ID)</sql>
        <sql>ALTER TABLE SHIFT_BREAKS ADD CONSTRAINT SHIFT_BREAKS_BREAKID FOREIGN KEY (BREAKID) REFERENCES BREAKS(ID)</sql>
        <sql>ALTER TABLE SHIFT_BREAKS ADD CONSTRAINT SHIFT_BREAKS_SHIFTID FOREIGN KEY (SHIFTID) REFERENCES SHIFTS(ID) </sql>        
        <sql>ALTER TABLE PRODUCTS_KIT ADD CONSTRAINT PRODUCTS_KIT_FK_1 FOREIGN KEY (PRODUCT) REFERENCES PRODUCTS(ID)</sql>
        <sql>ALTER TABLE PRODUCTS_KIT ADD CONSTRAINT PRODUCTS_KIT_FK_2 FOREIGN KEY (PRODUCT_KIT) REFERENCES PRODUCTS(ID)</sql>
        <sql>ALTER TABLE PRODUCTS ADD CONSTRAINT FK_PRODUCT_PROMOTIONID FOREIGN KEY (PROMOTIONID) REFERENCES PROMOTIONS(ID)</sql>
        <sql>ALTER TABLE PRODUCTS ADD CONSTRAINT PRODUCTS_PACKPRODUCT_FK FOREIGN KEY (PACKPRODUCT) REFERENCES PRODUCTS(ID)</sql>
    </changeSet>                                                                              
           
</databaseChangeLog>

